 CREATE SCHEMA MDSJL;

 -- DROP TABLE MDSJL.ESTADO
 CREATE TABLE MDSJL.ESTADO (
	ESTA_ID INT IDENTITY(1,1) NOT NULL,
	ESTA_CO_ESTADO CHAR(2) NOT NULL,
	ESTA_TABLA NVARCHAR(50) NOT NULL,
	ESTA_DESCRIPCION NVARCHAR(100) NOT NULL,
	ESTA_DESCRIPCION_MP NVARCHAR(100) NOT NULL,
	ESTA_CREATED_AT DATETIME2(0) NULL,
	ESTA_UPDATED_AT DATETIME2(0) NULL,
	ESTA_DELETED_AT DATETIME2(0) NULL, 
	ESTA_COLOR VARCHAR(15) NULL, 
	ESTA_ORDEN CHAR(1) NULL,
	CONSTRAINT ESTADO_PKEY PRIMARY KEY (ESTA_ID)
)

-- DROP TABLE MDSJL.TIPO_DOCUMENTO
CREATE TABLE MDSJL.TIPO_DOCUMENTO (
	TIPDOC_ID varchar(3) NOT NULL,
	TIPDOC_DESCRIPCION NVARCHAR(191) NOT NULL,
	TIPDOC_CREATED_AT DATETIME2(0) NULL,  
	TIPDOC_UPDATED_AT DATETIME2(0) NULL,
	TIPDOC_DELETED_AT DATETIME2(0) NULL,
	CONSTRAINT TIPO_DOCUMENTO_PKEY PRIMARY KEY (TIPDOC_ID)
)

 
 -- DELETE FROM MDSJL.USUARIO

SELECT * FROM MDSJL.USUARIO 

 CREATE TABLE MDSJL.USUARIO (
 	USU_ID BIGINT IDENTITY(1,1) NOT NULL, 
	-- COD_USUARIO NVARCHAR(30) NOT NULL,
	USU_TIPO_PERSONA NVARCHAR(2) NULL,
	USU_TIPO_DOCUMENTO NVARCHAR(2) NULL, 
	USU_NUMERO_DOCUMENTO NVARCHAR(20) NULL, --> DNI / PASATPORTE / RUC / CARNET

	USU_APE_PATERNO NVARCHAR(200) NULL,
	USU_APE_MATERNO NVARCHAR(200) NULL,
	USU_NOMBRES NVARCHAR(200) NULL,
	
	USU_RAZON_SOCIAL NVARCHAR(200) NULL,
	USU_DIRECCION NVARCHAR(200) NULL, 

	USU_DEPARTAMENTO VARCHAR(2) NULL,
	USU_PROVINCIA VARCHAR(2) NULL,
	USU_DISTRITO VARCHAR(2) NULL,

	USU_IND_ESTADO CHAR(1) NULL,
	USU_CLAVE NVARCHAR(255) NOT NULL,
	USU_NU_CELULAR CHAR(9) NULL,
	USU_CORREO NVARCHAR(200) NULL,

	USU_FEC_REGISTRO DATETIME2(0) NULL,
	USU_FEC_MODIFICACION DATETIME2(0) NULL,

	USU_FEC_NACE DATE NULL, --
	USU_SEXO VARCHAR(2) NULL, --
	IMAGEN NVARCHAR(MAX) NULL, --
	ID_ROLES SMALLINT NULL,
	
	ID_REPRESENTANTE BIGINT NULL,
    CONSTRAINT PK_USUARIO PRIMARY KEY (USU_ID), 
); 
 

UPDATE MDSJL.SOLICITUD 
	SET CREATED_BY = CAST(CREATED_BY as NVARCHAR(20)),
	 UPDATED_BY = CAST(UPDATED_BY as NVARCHAR(20))

-- Luego modificar las columnas
ALTER TABLE MDSJL.SOLICITUD
ALTER COLUMN CREATED_BY NVARCHAR(20) NULL;

ALTER TABLE MDSJL.SOLICITUD
ALTER COLUMN UPDATED_BY NVARCHAR(20) NULL;


SELECT * FROM MDSJL.SOLICITUD
 -- DROP TABLE MDSJL.SOLICITUD  
 CREATE TABLE MDSJL.SOLICITUD (
    SOLI_ID BIGINT IDENTITY(1,1) NOT NULL,
    SOLI_NU_EMI NVARCHAR(191) NULL,
	SOLI_NU_ANN NVARCHAR(10) NULL,
    SOLI_FECHA_EMISION DATETIME2(0) NULL,	
    SOLI_FECHA DATETIME2(0) NULL,	

    SOLI_NRO_EXPEDIENTE NVARCHAR(50) NULL,
    TIPO_DOCUMENTO_ID VARCHAR(3)  NULL, 
    SOLI_NUMERO_DOCUMENTO NVARCHAR(50) NULL,

    SOLI_ASUNTO NVARCHAR(1000) NOT NULL,
	SOLI_FOLIOS INT NULL,
	SOLI_COD_TUPA NVARCHAR(255) NULL,

	CREATED_AT DATETIME2(0) DEFAULT GETDATE() NULL, 
    UPDATED_AT DATETIME2(0) NULL,
    DELETED_AT DATETIME2(0) NULL,

	CREATED_BY NVARCHAR(20) NULL, -- EL SOLICITANTE NRO DE DOCUMENTO
    UPDATED_BY NVARCHAR(20) NULL,

	COD_USUARIO NVARCHAR(30) NOT NULL,
    SOLI_FECHA_OBSERVACION DATETIME2(0) NULL,
    SOLI_OBSERVACION NVARCHAR(MAX) NULL,
    SOLI_FECHA_LIMITE_SUBSANACION DATETIME2(0) NULL,
    SOLI_FECHA_SUBSANACION DATETIME2(0) NULL,
	SOLI_OBSERVADO_BY NVARCHAR(50) NULL,
	SOLI_FILE_OBSERVACION NVARCHAR(150) NULL,
	SOLI_ESTADO_ID INT NOT NULL,  --*

    CREATED_IP NVARCHAR(50) NULL,
    UPDATED_IP NVARCHAR(50) NULL,
	CONSTRAINT FK_SOLICITUD_TIPODOCUMENTO FOREIGN KEY (TIPO_DOCUMENTO_ID) REFERENCES MDSJL.TIPO_DOCUMENTO(TIPDOC_ID),
    CONSTRAINT PK_SOLICITUD PRIMARY KEY (SOLI_ID)
);


-- DROP TABLE MDSJL.HISTORIAL_SOLICITUD 
 CREATE TABLE MDSJL.HISTORIAL_SOLICITUD (
    HIS_ID BIGINT IDENTITY(1,1) NOT NULL,
    HIS_NUMERO NVARCHAR(191) NULL,
	HIS_NU_ANN NVARCHAR(10) NULL, 
	SOLICITUD_ID BIGINT NOT NULL,
	CREATED_AT DATETIME2(0) NULL, 
	CREATED_BY INT NULL,  
	COD_USUARIO NVARCHAR(30) NOT NULL,
	HIS_ESTADO INT NOT NULL,  --*
	HIS_FECHA_OBSERVACION DATETIME2(0) NULL,
    HIS_OBSERVACION NVARCHAR(MAX) NULL,
	HIS_COD_TUPA NVARCHAR(255) NULL,
	SOLI_OBSERVADO_BY NVARCHAR(50) NULL, 
    HIS_ASUNTO NVARCHAR(1000) NOT NULL,
	CONSTRAINT FK_HISTORIAL_SOLICITUD_SOLICITUD FOREIGN KEY (SOLICITUD_ID) REFERENCES MDSJL.SOLICITUD (SOLI_ID),
    CONSTRAINT PK_HISTORIAL_SOLICITUD PRIMARY KEY (HIS_ID)
);

-- DROP TABLE MDSJL.ARCHIVO_DOCUMENTO 
 CREATE TABLE MDSJL.ARCHIVO_PRINCIPAL (
	ARCHIPRIN_ID BIGINT IDENTITY(1,1) NOT NULL,
	SOLICITUD_ID BIGINT NOT NULL,
	ARCHIPRIN_NOMBRE_FILE_ORIGEN NVARCHAR(191) NOT NULL,
	ARCHIPRIN_FILE VARBINARY(MAX) NULL,
    CREATED_AT DATETIME2(0) NULL,
    UPDATED_AT DATETIME2(0) NULL,
    DELETED_AT DATETIME2(0) NULL,
	ARCHIPRIN_NOMBRE_FILE varchar(150) NULL,
	ARCHIPRIN_IS_UPLOAD CHAR(1) NULL,
	CONSTRAINT FK_ARCHIVO_PRINCIPAL_SOLICITUD FOREIGN KEY (SOLICITUD_ID) REFERENCES MDSJL.SOLICITUD (SOLI_ID),
	CONSTRAINT PK_ARCHIVO_PRINCIPAL PRIMARY KEY (ARCHIPRIN_ID)
);

-- DROP TABLE MDSJL.ANEXO
CREATE TABLE MDSJL.ANEXO (
    ANEX_ID BIGINT IDENTITY(1,1) NOT NULL,
    ANEX_NUMERO INT NULL,
    SOLICITUD_ID BIGINT NOT NULL,
    ANEX_NOMBRE_FILE_ORIGEN NVARCHAR(191) NOT NULL,
    ANEX_DETALLE NVARCHAR(191) NULL,
    ANEX_IS_UPLOAD NVARCHAR(191) NULL,
    ANEX_FILE VARBINARY(MAX) NULL,
    ANEX_IND_HABILITADO CHAR(1) NULL,
    ANEX_OBSERVACION NVARCHAR(191) NULL,
    CREATED_AT DATETIME2(0) NULL,
    UPDATED_AT DATETIME2(0) NULL,
    DELETED_AT DATETIME2(0) NULL,
    ANEX_NOMBRE_FILE NVARCHAR(150) NULL,
    CONSTRAINT PK_ANEXO PRIMARY KEY (ANEX_ID),
	CONSTRAINT FK_ANEXO_SOLICITUD FOREIGN KEY (SOLICITUD_ID) REFERENCES MDSJL.SOLICITUD(SOLI_ID)
);